<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Meeting Assistant</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts: Inter & Sarabun -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Sarabun:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Sarabun', 'Inter', sans-serif;
            background-color: #F3F4F6;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .drop-zone {
            transition: all 0.3s ease;
            border-style: dashed;
        }
        .drop-zone.active {
            border-color: #4F46E5;
            background-color: #EEF2FF;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-indigo-50 to-blue-100">

    <div class="max-w-4xl w-full bg-white rounded-2xl shadow-2xl overflow-hidden grid md:grid-cols-5 min-h-[600px]">
        
        <!-- Sidebar / Progress -->
        <div class="md:col-span-2 bg-slate-900 text-white p-8 flex flex-col justify-between relative overflow-hidden">
            <div class="absolute top-0 right-0 -mr-16 -mt-16 w-64 h-64 bg-indigo-600 rounded-full opacity-20 blur-3xl"></div>
            <div class="absolute bottom-0 left-0 -ml-16 -mb-16 w-64 h-64 bg-blue-500 rounded-full opacity-20 blur-3xl"></div>
            
            <div class="relative z-10">
                <div class="flex items-center space-x-3 mb-8">
                    <div class="w-10 h-10 bg-indigo-500 rounded-lg flex items-center justify-center shadow-lg">
                        <i class="fa-solid fa-robot text-xl"></i>
                    </div>
                    <span class="text-xl font-bold tracking-wide">AI Summary</span>
                </div>

                <div class="space-y-6">
                    <div class="step-indicator flex items-center space-x-4 text-indigo-200" id="ind-step-1">
                        <div class="w-8 h-8 rounded-full border-2 border-indigo-500 bg-indigo-600 text-white flex items-center justify-center font-bold text-sm">1</div>
                        <span class="font-medium text-white">Input Data</span>
                    </div>
                    <div class="h-8 border-l-2 border-slate-700 ml-4"></div>
                    
                    <div class="step-indicator flex items-center space-x-4 text-slate-500" id="ind-step-2">
                        <div class="w-8 h-8 rounded-full border-2 border-slate-600 flex items-center justify-center font-bold text-sm">2</div>
                        <span class="font-medium">Review AI Draft</span>
                    </div>
                    <div class="h-8 border-l-2 border-slate-700 ml-4"></div>

                    <div class="step-indicator flex items-center space-x-4 text-slate-500" id="ind-step-3">
                        <div class="w-8 h-8 rounded-full border-2 border-slate-600 flex items-center justify-center font-bold text-sm">3</div>
                        <span class="font-medium">Send Email</span>
                    </div>
                </div>
            </div>

            <div class="relative z-10 text-sm text-slate-400 mt-10">
                <p>Powered by <span class="text-indigo-400 font-semibold">n8n Workflow</span></p>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="md:col-span-3 p-8 bg-white relative">
            
            <!-- STEP 1: INPUT -->
            <div id="step-1" class="step-content transition-all duration-300">
                <h2 class="text-2xl font-bold text-slate-800 mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</h2>
                <p class="text-slate-500 mb-6 text-sm">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏£‡∏∏‡∏õ</p>

                <div class="space-y-4">
                    <!-- Text Area -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡πà‡∏≠ / Note</label>
                        <textarea id="input-notes" rows="3" class="w-full p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none resize-none transition" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å‡πÜ ‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
                    </div>

                    <!-- Audio Upload -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á (Audio)</label>
                        <div id="drop-audio" class="drop-zone border-2 border-slate-200 rounded-xl p-4 text-center cursor-pointer hover:bg-slate-50 relative group">
                            <input type="file" id="file-audio" accept="audio/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                            <i class="fa-solid fa-microphone-lines text-2xl text-slate-400 mb-2 group-hover:text-indigo-500 transition"></i>
                            <p class="text-xs text-slate-500" id="audio-filename">Click or Drag audio file here</p>
                        </div>
                    </div>

                    <!-- Image Upload -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (Images)</label>
                        <div id="drop-image" class="drop-zone border-2 border-slate-200 rounded-xl p-4 text-center cursor-pointer hover:bg-slate-50 relative group">
                            <input type="file" id="file-image" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                            <i class="fa-regular fa-image text-2xl text-slate-400 mb-2 group-hover:text-pink-500 transition"></i>
                            <p class="text-xs text-slate-500" id="image-filename">Click or Drag image here</p>
                        </div>
                    </div>
                </div>

                <div class="mt-8">
                    <button onclick="processToStep2()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-xl font-semibold shadow-lg shadow-indigo-200 transition-all flex justify-center items-center gap-2">
                        <span>Generate AI Summary</span>
                        <i class="fa-solid fa-wand-magic-sparkles"></i>
                    </button>
                </div>
            </div>

            <!-- LOADING OVERLAY -->
            <div id="loading-state" class="hidden absolute inset-0 bg-white z-20 flex flex-col items-center justify-center">
                <div class="relative w-20 h-20 mb-4">
                    <div class="absolute top-0 left-0 w-full h-full border-4 border-indigo-100 rounded-full"></div>
                    <div class="absolute top-0 left-0 w-full h-full border-4 border-indigo-600 rounded-full border-t-transparent animate-spin"></div>
                    <i class="fa-solid fa-brain absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-indigo-600 text-xl"></i>
                </div>
                <h3 class="text-lg font-semibold text-slate-800 animate-pulse">AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</h3>
                <p class="text-slate-500 text-sm mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ñ‡∏≠‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</p>
            </div>

            <!-- STEP 2: REVIEW & SEND -->
            <div id="step-2" class="step-content hidden transition-all duration-300 h-full flex flex-col">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-xl font-bold text-slate-800">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏£‡∏∏‡∏õ</h2>
                    <button onclick="backToStep1()" class="text-slate-400 hover:text-slate-600 text-sm"><i class="fa-solid fa-arrow-left mr-1"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>

                <!-- AI Output Area -->
                <div class="flex-grow mb-4 relative group h-48">
                    <label class="absolute top-2 right-2 bg-green-100 text-green-700 text-xs px-2 py-1 rounded font-bold pointer-events-none">
                        <i class="fa-solid fa-check-circle mr-1"></i>AI Generated
                    </label>
                    <textarea id="ai-summary-text" class="w-full h-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none resize-none text-slate-700 leading-relaxed text-sm" placeholder="AI Result will appear here..."></textarea>
                </div>

                <!-- Email Subject -->
                <div class="mb-3">
                    <label class="block text-sm font-medium text-slate-700 mb-1">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏≠‡∏µ‡πÄ‡∏°‡∏• (Subject)</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fa-solid fa-heading text-slate-400"></i>
                        </div>
                        <input type="text" id="email-subject" class="w-full pl-10 p-2.5 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition text-sm font-semibold text-slate-700" placeholder="‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°...">
                    </div>
                </div>

                <!-- Email Input (Multi) -->
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-1">
                        <label class="block text-sm font-medium text-slate-700">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏• (Recipients)</label>
                        <span class="text-xs text-slate-400 bg-slate-100 px-2 py-0.5 rounded">‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≠‡∏°‡∏°‡∏≤ (,) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô</span>
                    </div>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fa-regular fa-envelope text-slate-400"></i>
                        </div>
                        <input type="text" id="recipient-email" class="w-full pl-10 p-2.5 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition text-sm" placeholder="boss@company.com, team@company.com">
                    </div>
                </div>

                <button onclick="submitWebhook()" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-semibold shadow-lg shadow-green-200 transition-all flex justify-center items-center gap-2">
                    <span>Confirm & Send Email</span>
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </div>

            <!-- SUCCESS STATE -->
            <div id="success-state" class="hidden h-full flex flex-col items-center justify-center text-center">
                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mb-6">
                    <i class="fa-solid fa-check text-4xl text-green-600"></i>
                </div>
                <h2 class="text-2xl font-bold text-slate-800 mb-2">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h2>
                <p class="text-slate-500 mb-8 max-w-xs mx-auto">‡∏£‡∏∞‡∏ö‡∏ö n8n ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                <button onclick="location.reload()" class="px-6 py-2 bg-white border border-slate-300 text-slate-600 rounded-lg hover:bg-slate-50 transition">
                    ‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà
                </button>
            </div>

        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // Webhook URL Configuration
        const WEBHOOK_URL = 'https://hooks.payso.one/webhook-test/send-meeting-email';

        // File Input Handler Logic
        function setupFileInput(id, labelId) {
            const input = document.getElementById(id);
            const label = document.getElementById(labelId);
            const wrapper = input.parentElement;

            input.addEventListener('change', (e) => {
                if(input.files.length > 0) {
                    label.innerText = input.files[0].name;
                    label.classList.add('text-indigo-600', 'font-semibold');
                    wrapper.classList.add('border-indigo-500', 'bg-indigo-50');
                }
            });
        }
        setupFileInput('file-audio', 'audio-filename');
        setupFileInput('file-image', 'image-filename');

        // Navigation & State Logic
        function updateStepper(step) {
            const steps = [1, 2, 3];
            steps.forEach(s => {
                const el = document.getElementById(`ind-step-${s}`);
                const circle = el.querySelector('div');
                const text = el.querySelector('span');

                if (s === step) {
                    // Active
                    circle.className = "w-8 h-8 rounded-full border-2 border-indigo-500 bg-indigo-600 text-white flex items-center justify-center font-bold text-sm transition-all";
                    text.classList.add('text-white');
                    text.classList.remove('text-slate-500');
                } else if (s < step) {
                    // Completed
                    circle.className = "w-8 h-8 rounded-full border-2 border-green-500 bg-green-500 text-white flex items-center justify-center font-bold text-sm transition-all";
                    circle.innerHTML = '<i class="fa-solid fa-check"></i>';
                    text.classList.remove('text-white');
                    text.classList.add('text-indigo-200');
                } else {
                    // Pending
                    circle.className = "w-8 h-8 rounded-full border-2 border-slate-600 flex items-center justify-center font-bold text-sm text-slate-400 transition-all";
                    circle.innerHTML = s;
                    text.classList.remove('text-white');
                    text.classList.add('text-slate-500');
                }
            });
        }

        // STEP 1 -> STEP 2 (Simulate AI)
        function processToStep2() {
            // Validate inputs if needed
            const notes = document.getElementById('input-notes').value;

            document.getElementById('step-1').classList.add('hidden');
            document.getElementById('loading-state').classList.remove('hidden');

            // SIMULATE AI GENERATION DELAY (2 Seconds)
            setTimeout(() => {
                const mockSummary = generateMockSummary(notes);
                document.getElementById('ai-summary-text').value = mockSummary;
                
                // Auto-generate Subject
                const today = new Date().toLocaleDateString('th-TH');
                document.getElementById('email-subject').value = `‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${today}`;

                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('step-2').classList.remove('hidden');
                updateStepper(2);
            }, 2000);
        }

        function backToStep1() {
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('step-1').classList.remove('hidden');
            updateStepper(1);
        }

        function generateMockSummary(originalNotes) {
            const today = new Date().toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
            
            let base = `üìÖ **‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:** ${today}\n`;
            base += `üì¢ **‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°:** ‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™ (Q2 Strategy & Operations)\n\n`;
            
            if (originalNotes.length > 5) {
                base += `üìù **‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:**\n"${originalNotes}"\n\n`;
            }

            base += `üìä **‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (Executive Summary):**\n`;
            base += `- ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÑ‡∏î‡πâ‡∏´‡∏≤‡∏£‡∏∑‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‡πÇ‡∏î‡∏¢‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ï‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå\n`;
            base += `- ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î‡∏ú‡πà‡∏≤‡∏ô Social Media ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô 200,000 ‡∏ö‡∏≤‡∏ó\n`;
            base += `- ‡∏ó‡∏µ‡∏° IT ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á Server Load ‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á Peak time ‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏≤‡∏¢ Cloud Storage ‡∏ã‡∏∂‡πà‡∏á‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏≠‡∏ö‡πÉ‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£\n\n`;

            base += `üöÄ **‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏ï‡πà‡∏≠ (Action Items):**\n`;
            base += `1. **[‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ä‡∏≤‡∏¢]** ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏â‡∏ö‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏®‡∏∏‡∏Å‡∏£‡πå‡∏ô‡∏µ‡πâ\n`;
            base += `2. **[‡∏ó‡∏µ‡∏° IT]** ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Vendor ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ Cloud Server ‡πÉ‡∏´‡∏°‡πà\n`;
            base += `3. **[‡∏ó‡∏µ‡∏° Marketing]** ‡∏ô‡∏±‡∏î Brainstorming ‡πÅ‡∏Ñ‡∏°‡πÄ‡∏õ‡∏ç‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏û‡∏∏‡∏ò‡∏´‡∏ô‡πâ‡∏≤ ‡πÄ‡∏ß‡∏•‡∏≤ 14:00 ‡∏ô.\n\n`;
            
            base += `üí° **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å 2 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤`;

            return base;
        }

        // STEP 2 -> SUBMIT TO N8N
        async function submitWebhook() {
            const email = document.getElementById('recipient-email').value;
            const subject = document.getElementById('email-subject').value;
            
            if (!email) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏ô');
                return;
            }

            const btn = document.querySelector('button[onclick="submitWebhook()"]');
            const originalBtnText = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Sending...';
            btn.disabled = true;

            const formData = new FormData();
            formData.append('notes', document.getElementById('input-notes').value);
            formData.append('ai_summary', document.getElementById('ai-summary-text').value);
            formData.append('email', email);
            formData.append('subject', subject);
            
            const audioFile = document.getElementById('file-audio').files[0];
            const imageFile = document.getElementById('file-image').files[0];
            
            if(audioFile) formData.append('audio_file', audioFile);
            if(imageFile) formData.append('image_file', imageFile);

            try {
                // Attempt 1: Standard Fetch (Good for getting response)
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    showSuccess();
                } else {
                    throw new Error('Server returned ' + response.status);
                }
            } catch (error) {
                console.warn('Standard fetch failed (likely CORS), retrying with no-cors...', error);
                
                try {
                    // Attempt 2: No-CORS Fetch (Fire and forget, browser won't report detailed errors)
                    await fetch(WEBHOOK_URL, {
                        method: 'POST',
                        body: formData,
                        mode: 'no-cors'
                    });
                    
                    // If we get here in no-cors mode, it means the request was sent (Opaque).
                    // We assume success for the UX flow.
                    console.log('No-cors request sent.');
                    showSuccess();
                    
                } catch (innerError) {
                    console.error('All fetch attempts failed:', innerError);
                    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á (Network/Blocker Error) ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö UI');
                    // Force success for demo purposes if everything fails
                    showSuccess();
                }
            } finally {
                btn.innerHTML = originalBtnText;
                btn.disabled = false;
            }
        }

        function showSuccess() {
            updateStepper(3);
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('success-state').classList.remove('hidden');
        }
    </script>
</body>
</html>
